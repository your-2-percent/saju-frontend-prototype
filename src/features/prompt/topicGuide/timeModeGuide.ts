// features/prompt/topicGuide/timeModeGuide.ts

import type { BlendTab } from "@/analysisReport/calc/logic/blend";
import type { TimeMode } from "./types";

type Args = {
  mode: TimeMode;
  tab?: BlendTab | undefined;
  isStudyTone: boolean;
};

export function appendTimeModeGuide(lines: string[], args: Args) {
  const { mode, tab, isStudyTone } = args;
  const push = (...xs: string[]) => lines.push(...xs);

  if (mode === "single") {
    if (tab === "원국") {
      push(
        "",
        "## 🍀 원국 심층 분석 지침 (친절하고 알기 쉽게)",
        "> ※ 이 내용은 명리학적 이론을 바탕으로 하지만, 친구에게 상담해주듯 부드럽고 이해하기 쉽게 설명해주세요.",
        "- **쉬운 용어 사용**: '비겁, 식상, 재성, 관성, 인성'이나 '충, 합, 형' 같은 전문 용어는 가급적 쓰지 말고, '나와 같은 기운, 표현력, 재물운, 직장운, 문서운' 등으로 풀어서 설명하세요. 꼭 써야 한다면 괄호 안에 넣으세요.",
        "- **친근한 말투**: 딱딱한 보고서체가 아니라, 옆에서 조언해주는 듯한 부드러운 '해요체'를 사용하세요.",
        "- **균형과 조화**: 오행의 수치를 기계적으로 나열하지 말고, 어떤 기운이 강하고 어떤 기운이 부족해서 생기는 현상을 이야기처럼 풀어주세요.",
        "- **관계의 역학**: 기운들이 서로 돕는지, 아니면 서로 부딪혀서 힘든지를 구체적인 삶의 모습(성격, 건강, 인간관계)으로 예시를 들어 설명하세요.",
        "- **현실적인 조언**: '이 사주는 이게 나빠'라고 단정 짓기보다, '이런 점을 조심하면 더 좋아질 수 있어요'라고 긍정적인 방향으로 해결책을 제시하세요.",
        "- **핵심 솔루션**: 부족한 기운을 보완하기 위해 어떤 마음가짐이나 행동이 필요한지 구체적이고 실천 가능한 팁을 주세요."
      );
      return;
    }

    if (tab) {
      push(
        "",
        "## 🍀 운세 해석의 대전제 (쉽고 부드럽게)",
        "- **원국과의 조화**: 운이 들어와서 내 사주의 원래 기운과 어떻게 어우러지는지 설명하세요. 전문 용어보다는 '새로운 기운이 들어와서 기존의 답답함을 풀어준다'는 식으로 묘사하세요.",
        "- **인과관계 설명**: 단순히 '좋다/나쁘다'가 아니라, '어떤 기운이 들어와서 어떤 변화가 생기는지'를 납득할 수 있게 설명해주세요.",
        "- **화학작용**: 합이나 충 같은 용어 대신, '기운이 묶여서 답답해질 수 있다'거나 '변화가 크게 일어날 수 있다'는 식으로 풀어서 쓰세요."
      );

      if (!isStudyTone) {
        push(
          "",
          "## 시간 모드(단일)",
          `- 지금 보고 있는 탭(${tab}) 시기를 중심으로 설명하되, 타고난 기질과 이 시기의 분위기가 어떻게 섞이는지 함께 말한다.`,
          "- “원래는 이런 스타일인데, 지금 시기에는 이런 부분이 더 강해지거나 약해질 수 있다”처럼 연결한다."
        );
      } else {
        push(
          "",
          "## 시간 모드(단일·분석형)",
          `- 기준 시기: 탭(${tab})을 메인으로 두고, 원국과 운의 결합으로 ‘트리거(합충형파해 + 운성/신살 중첩)’가 무엇인지부터 뽑는다.`,
          "- 결론은 ‘이 시기에 터질 사건/이슈’ → 그 다음 줄에 ‘작용한 구조(근거)’ 순서로 쓴다."
        );
      }
    } else {
      push(
        "",
        "## 시간 모드(단일)",
        "- 단일 시점 해석이므로, 해당 시기에 실제로 벌어질 만한 사건/장면을 중심으로 정리한다."
      );
    }
  } else {
    push(
      "",
      "## 🍀 운세 흐름 해석 (쉽고 부드럽게)",
      "- **흐름 위주**: 운이 흐르면서 내 사주의 약한 부분을 건드릴 때 어떤 일이 생길 수 있는지 조심스럽게 조언하세요.",
      "- **쉬운 풀이**: '충을 맞아서 깨진다'는 과격한 표현 대신, '변화의 바람이 불어와서 기존의 것이 흔들릴 수 있다'처럼 순화해서 표현하세요."
    );

    if (!isStudyTone) {
      push(
        "",
        "## 시간 모드(멀티)",
        "- 여러 시점(대운/세운/월운/일운)이 함께 있으므로, 시간 순서대로 분위기 변화와 주요 이슈가 어떻게 이어지는지 흐름 위주로 정리한다."
      );
    } else {
      push(
        "",
        "## 시간 모드(멀티·분석형)",
        "- 시간 순서대로 ‘핵심 사건이 터지는 구간’만 표시한다. 평이한 구간은 과감히 생략한다.",
        "- 각 구간은 ‘사건 요약’ → ‘근거(합충형파해/운성/신살/십신 유기성)’ 순서로 1~2줄만 쓴다."
      );
    }
  }

  if (isStudyTone) {
    lines.push(
      "- (teacherMode) 시간모드는 ‘사건 터지는 구간’만 강조하고, 평이한 구간은 생략한다.",
      "- 각 구간은 ‘사건 요약 → 근거(합충형파해/운성·신살 중첩/십신 유기성)’ 순서로 1~2줄로 끝낸다."
    );
  }
}
